<div class="teamName" id="<%= @team.id %>" data-team-name="<%= @team.name %>" 
  style="<%= "text-align:center; #{"display:none;" if @is_hidden}" %>">
  <h2 style="margin:10px;"><%= @team.name %></h2>
</div>

<% team_slots = @team.get_slots_with_players %>
<% static_cell_width = "90px" %>
<% category_cell_width = "60px" %>
<% slot_cell_width = "30px" %>
<% minmax = { :min => 0, :max => 100 } %>
<% first_table_for_team = true %>
<% remove_player_cell_wid = "20px" %>
<% remove_player_img_attrs = { alt: "remove player", style: "max-width:100%; display:none;", onclick: 'removePlayerFromTeam(this)' } %>

<% team_slots.each do |type, position_set| %>
  <table class="<%= "team " + type %>" id="<%= type + @team.id.to_s %>" style="<%= "display:none;" if (!first_table_for_team || @is_hidden) %>">
    <thead class="team">
      <tr>
        <td style="width: <%= remove_player_cell_wid %>; min-width: <%= remove_player_cell_wid %>; max-width: <%= remove_player_cell_wid %>"></td>
        <td style="width: <%= slot_cell_width %>; min-width: <%= slot_cell_width %>;">Slot</td>
        <td style="width: <%= static_cell_width %>; min-width: <%= static_cell_width %>;">Name</td>
        <% category_order = [ nil, nil, nil ] %>
        <% stats_categories = @draft_helper.setting_manager.convert_stats_to_hash[type.to_sym] %>
        <% stats_categories.each do |category| %>
          <% category_order.push(category) %>
          <td style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"><%= category %></td>
        <% end %>
      </tr>
    </thead>
    <tbody>
    <% position_set.each do |slot| %>
      <% if slot[:id].nil? %>
        <% player = nil %>
      <% else %>
        <% player = Player.find(slot[:id]) %>
        <% player_percentiles = @data_manager.initial_percentiles[slot[:id]] %>
        <% player_means = @data_manager.means[slot[:id]] %>
      <% end %>

      <tr class="<%= "team #{type} team_percentile" %>" data-player-id="<%= player.id if !player.nil? %>">
        <% if !player.nil? %>
          <td style="width: <%= remove_player_cell_wid %>; min-width: <%= remove_player_cell_wid %>; max-width: <%= remove_player_cell_wid %>">
            <%= image_tag("cross2.png", remove_player_img_attrs ) %>
          </td>
        <% else %>
          <td style="width: <%= remove_player_cell_wid %>; min-width: <%= remove_player_cell_wid %>; max-width: <%= remove_player_cell_wid %>"></td>
        <% end %>
        <td style="width: <%= slot_cell_width %>; min-width: <%= slot_cell_width %>;"><%= slot[:position] %></td>
        <% if !player.nil? %>
          <td style="width: <%= static_cell_width %>; min-width: <%= static_cell_width %>;"><%= player.name %></td>
          <% category_order.each_with_index do |category, index| %>
            <% next if index == 0 || index == 1 || index == 2 %>

            <% player_percentiles[category].nil? ? player_percentile = 0.0 : player_percentile = player_percentiles[category] %>
            <% td_class = @draft_helper.get_color_class(player_percentile, minmax) %>
            <td class=<%= td_class %> style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"><%= player_percentile.round(3).to_s + "%" %></td>
          <% end %>
        <% else %>
          <td style="width: <%= static_cell_width %>; min-width: <%= static_cell_width %>;"></td>
          <% category_order.each_with_index do |category, index| %>
            <% next if index == 0 || index == 1 || index == 2 %>
            <td style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"></td>
          <% end %>
        <% end %>
      </tr>

      <tr class="<%= "team #{type} team_raw" %>" style="display:none;">
        <% if !player.nil? %>
          <td style="width: <%= remove_player_cell_wid %>; min-width: <%= remove_player_cell_wid %>; max-width: <%= remove_player_cell_wid %>">
            <%= image_tag("cross2.png", remove_player_img_attrs ) %>
          </td>
        <% else %>
          <td style="width: <%= remove_player_cell_wid %>; min-width: <%= remove_player_cell_wid %>; max-width: <%= remove_player_cell_wid %>"></td>
        <% end %>
        <td style="width: <%= slot_cell_width %>; min-width: <%= slot_cell_width %>;"><%= slot[:position] %></td>
        <% if !player.nil? %>
          <td style="width: <%= static_cell_width %>; min-width: <%= static_cell_width %>;"><%= player.name %></td>
          <% category_order.each_with_index do |category, index| %>
            <% next if index == 0 || index == 1 || index == 2 %>

            <% player_percentiles[category].nil? ? player_percentile = 0.0 : player_percentile = player_percentiles[category] %>
            <% td_class = @draft_helper.get_color_class(player_percentile, minmax) %>
            <td class=<%= td_class %> style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"><%= player_means[category] %></td>
          <% end %>
        <% else %>
          <td style="width: <%= static_cell_width %>; min-width: <%= static_cell_width %>;"></td>
          <% category_order.each_with_index do |category, index| %>
            <% next if index == 0 || index == 1 || index == 2 %>
            <td style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"></td>
          <% end %>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>

  <table class="<%= "teamTotals #{type}" %>" id="<%= type + @team.id.to_s + "-totals" %>" style="<%= "display:none;" if (!first_table_for_team || @is_hidden) %>">

    <tbody>
      <% team_percentiles = @team.team_percentiles[type.to_sym] %>
      <tr>
        <td style="width: <%= remove_player_cell_wid %>; min-width: <%= remove_player_cell_wid %>; max-width: <%= remove_player_cell_wid %>"></td>
        <td style="width: <%= slot_cell_width %>; min-width: <%= slot_cell_width %>;"></td>
        <td style="width: <%= static_cell_width %>; min-width: <%= static_cell_width %>;">Average:</td>

        <% category_order.each_with_index do |category, index| %>
          <% next if index == 0 || index == 1 || index == 2 %>

          <% if !team_percentiles[category].nil? %>
            <td style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"> <%= team_percentiles[category][:avg_percentile].round(3).to_s + "%" %> </td>
          <% else %>
            <td style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"></td>
          <% end %>
        <% end %>
      </tr>
      <tr>
        <td style="width: <%= remove_player_cell_wid %>; min-width: <%= remove_player_cell_wid %>; max-width: <%= remove_player_cell_wid %>"></td>
        <td style="width: <%= slot_cell_width %>; min-width: <%= slot_cell_width %>;"></td>
        <td style="width: <%= static_cell_width %>; min-width: <%= static_cell_width %>;">Total:</td>
        <% category_order.each_with_index do |category, index| %>
          <% next if index == 0 || index == 1 || index == 2 %>

          <% if !team_percentiles[category].nil? %>
            <td style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"><%= (team_percentiles[category][:values].reduce(0, :+)).round(3).to_s + "%" %></td>
          <% else %>
            <td style="width: <%= category_cell_width %>; min-width: <%= category_cell_width %>;"></td>
          <% end %>
        <% end %>
      </tr>

    </tbody>
  </table>
  <% first_table_for_team = false %>
<% end %>
